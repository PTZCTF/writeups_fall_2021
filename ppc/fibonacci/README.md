# Разбор таска Фибоначчи

Категория:&nbsp;&nbsp;`PPC`    
Стоимость:&nbsp;`100`  
First blood:&nbsp;&nbsp;`nikmac10x`

---

## Что нам дано?

Мне очень нравятся последовательности. Поэтому я подготовила для тебя простой таск на числа Фибоначчи. Если индекс символа -- число Фибоначчи, то это часть флага. Но в 2019 году был таск, который решался ручками. В этот раз всё по-честному: только код :)

И ниже был прикреплён файл: [fibonacci.txt](./src/fibonacci.txt)

---

## Как начать решать?

Первое, что нам нужно заметить: таск о последовательности Фибоначчи. Последовательность чисел Фибоначчи формируется из 0 и 1, все последующие числа являются суммой двух предыдущих:
`0, 1, 1, 2, 3, 5, 8, 13, 21, 34, 55, 89, 144...` 

Также сказано, что в этом таске нужно писать код для решения (иначе это будет долго). Значит, будем писать на Python.

Посмотрим на содержимое файла `fibonacci.txt`:
```
ptzcFtP-fs	a+{dfG.UOLioM\'T `DaI
cmP=X
```

Нулевой символ - `p`, первый - `t`, второй `z`, третий `c`,  пятый `f`. То есть можем сделать вывод, что i-ый символ флага стоит на позиции i-ого число последовательности чисел Фибоначчи.

> Самое главное, что нужно заметить в файле: есть переносы строк, значит, нужно открывать его как в бинарном режиме чтения

---

## Решение

Итак, самое первое, что нужно сделать открыть файл (не забываем про бинарный режим чтения)

```python

enc_flag = open("fibonacci.txt", "rb").read()
print(enc_flag) # ptzcFtP-fs	a+{...
```

Затем создаём переменную для хранения нашего реального флага.

```python
flag = ""
```

### 1. Функция для создания последовательности Фибоначчи

Нужно создать функцию для вычисления последовательности чисел Фибоначчи. Так-то можно сделать это и в цикле, но красивее сделать отдельную функцию

```python

def next_fib(n):
    # Первоначальные значения для последовательности
    a = 0
    b = 1
    for _ in range(n):
        c = a
        a = b
        b += c
        yield b
```

> Подробнее об `yield`:
>
> Yield это ключевое слово, которое используется примерно как return — отличие в том, что функция вернёт генератор.
>
> В первый запуск вашей функции, она будет исполняться от начала до того момента, когда она наткнётся на yield — тогда она вернёт первое значение из цикла. На каждый следующий вызов будет происходить ещё одна итерация написанного вами цикла, возвращаться будет следующее значение — и так пока значения не кончатся.
>
> Пример: функция, которая возвращает два в степени i
```python
def get_2_in_pow():
    a = 1
    while True:
        yield a
        a *= 2

```
> Создадим переменую, хранящую этот генератор:
```python
generator_2_in_pow = get_2_in_pow()
```
> Теперь в цикле будем вызывать двойку в следующей степени, при этом выводя степень 
```python
for i in range(10):
    print(i, generator_2_in_pow.__next__(), end = ", ")
# 0 1, 1 2, 2 4, 3 8, 4 16, 5 32, 6 64, 7 128, 8 256, 9 512,
```

Больше можете прочитать [здесь](https://habr.com/ru/post/132554/).

### Чтение файла и "заполнение" флага

Мы создали генератор последовательности чисел Фибоначчи. Теперь можем приступать к основной части решения таска.

Создаим переменную для чисел Фибоначчи:
```python
fibonacci_for_flag = list(next_fib(100))
```
По порядку: 
- Мы получили 100 чисел Фибоначчи:
    ```python
    next_fib(100)
    ```
- Преобразуем полученные числа в массив чисел:
    ```python
    list(next_fib(100))
    ```

Теперь идём по числам Фибоначчи с ограничем, чтобы они не были больше длины файла, и записываем символы в итоговый флаг:

```python

# Идём по элементам массива fibonacci_for_flag
for fib in fibonacci_for_flag:
    # Если значение числа Фибоначчи больше длины файла, 
    # то выходим из цикла
    if fib >= len(enc_flag):
        break

    # Иначе записываем во флаг
    else:
        # Так как байты в Python обрабатываются как числа,
        # то берём символ от этого числа: chr(10) = "\n"
        flag += chr(enc_flag[fib])

print(flag) # pttzctf{im_ADD!c7Ed_70_S3quenCeS}
```

Не забываем, что последовательность чисел Фибоначчи соержит в себе две единицы подряд, это объясняет, почему вывелось две буквы `t`.

---

## Результат

Итоговый код вы можете найти [здесь](./src/solve.py)

Флаг: `ptzctf{im_ADD!c7Ed_70_S3quenCeS}`
